import requests
import time

headers = {
    "User-Agent": "Mozilla/5.0",
    "X-Requested-With": "XMLHttpRequest"
}

with open("ghdb_dorks_only.txt", "w", encoding="utf-8") as file:
    for offset in range(0, 100, 20):  # Test first 5 pages
        print(f"Fetching offset {offset}")
        url = f"https://www.exploit-db.com/search?ajax=true&order_by=date_published&order=desc&offset={offset}&q=&type=ghdb"
        try:
            response = requests.get(url, headers=headers)
            response.raise_for_status()

            try:
                data = response.json()
                for row in data["data"]:
                    dork = row["description"].strip()
                    file.write(dork + "\n")
            except Exception as parse_error:
                print(f"JSON Parse Error at offset {offset}: {parse_error}")
                print("Response content:")
                print(response.text[:500])  # print part of it
                break
        except Exception as e:
            print(f"Request failed at offset {offset}: {e}")
        time.sleep(1)
